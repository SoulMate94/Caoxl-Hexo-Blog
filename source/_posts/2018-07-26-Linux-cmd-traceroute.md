---
title: Linux 命令 「traceroute」
date: 2018-07-26 09:15:12
categories: Linux cmd
tags: [Linux]
---

> **traceroute命令**用于追踪数据包在网络上的传输时的全部路径，它默认发送的数据包大小是`60`字节。

<!-- more -->

通过`traceroute`我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。当然每次数据包由某一同样的出发点（`source`）到达某一同样的目的地(`destination`)走的路径可能会不一样，但基本上来说大部分时候所走的路由是相同的。

`traceroute`通过发送小的数据包到目的设备直到其返回，来测量其需要多长时间。一条路径上的每个设备`traceroute`要测3次。输出结果中包括每次测试的时间(ms)和设备的名称（如有的话）及其ip地址。

# 语法

```
    traceroute (选项) (参数)
```

# 选项

- `-d`: 使用`Socket`层级的排错功能
- `-f`<存货数值>: 设置第一个检测数据包的存活数值`TTL`的大小
- `-F`: 设置勿离断位
- `-g`<网关>: 设置来源路由网关, 最多可设置8个
- `-i`<网络界面>: 使用指定的网络界面送出数据包
- `-I`: 使用ICMP回应取代UDP资料信息
- `-m`<存活数值>: 设置检测数据包的最大存活数值TTL的大小
- `-n`: 直接使用IP地址而非主机名称
- `-p`<通信端口>: 设置UDP传输协议的通信端口
- `-r`: 忽略普通的`Routing Table`, 直接将数据包送到远端主机上
- `-s`<来源地址>: 设置本地主机送出数据包的`IP`地址
- `-t`<服务类型>: 设置检测数据包的`TOS`数值
- `-v`: 详细显示指令的执行过程
- `-w`<超时秒数>: 设置等待远端主机回报的时间
- `-x`: 开启或关闭数据包的正确性检验


# 参数

- 主机: 指定目的主机`IP`地址或主机名


# 实例

- `www.caoxl.com`

```
    [root@caoxianliang ~]# traceroute www.caoxl.com
    traceroute to www.caoxl.com (47.91.221.85), 30 hops max, 60 byte packets
     1  * * *
     2  * * *
     3  * * *
     4  * * *
     5  * * *
     6  * * *
     7  * * *
     8  * * *
     9  * * *
    10  * * *
    11  * * *
    12  * * *
    13  * * *
    14  * * *
    15  * * *
    16  * * *
    17  * * *
    18  * * *
    19  * * *
    20  * * *
    21  * * *
    22  * * *
    23  * * *
    24  * * *
    25  * * *
    26  * * *
    27  * * *
    28  * * *
    29  * * *
    30  * * *
```

- `www.baidu.com`

```
    [root@caoxianliang ~]# traceroute www.baidu.com
    traceroute to www.baidu.com (103.235.46.39), 30 hops max, 60 byte packets
     1  * * *
     2  11.211.16.5 (11.211.16.5)  6.214 ms 11.211.20.1 (11.211.20.1)  9.277 ms  9.461 ms
     3  11.211.20.122 (11.211.20.122)  1.062 ms 11.211.20.118 (11.211.20.118)  1.140 ms 11.211.20.154 (11.211.20.154)  1.073 ms
     4  116.251.72.162 (116.251.72.162)  1.486 ms 116.251.118.198 (116.251.118.198)  1.475 ms 116.251.74.154 (116.251.74.154)  1.492 ms
     5  p55967.hkg.equinix.com (119.27.63.97)  1.377 ms 116.251.65.85 (116.251.65.85)  2.208 ms p55967.hkg.equinix.com (119.27.63.97)  1.263 ms
     6  103.235.45.0 (103.235.45.0)  3.442 ms p55967.hkg.equinix.com (119.27.63.97)  1.669 ms s55967.hkg.equinix.com (119.27.63.98)  1.970 ms
     7  * 103.235.45.0 (103.235.45.0)  2.189 ms *
     8  * * *
     9  * * *
    10  * * *
    11  * * *
    12  * * *
    13  * * *
    14  * * *
    15  * * *
    16  * * *
    17  * * *
    18  * * *
    19  * * *
    20  * * *
    21  * * *
    22  * * *
    23  * * *
    24  * * *
    25  * * *
    26  * * *
    27  * * *
    28  * * *
    29  * * *
    30  * * *
```

> 记录按序列号从1开始，**每个纪录就是一跳 ，每跳表示一个网关**，我们看到每行有三个时间，单位是ms，其实就是`-q`的默认参数。探测数据包向每个网关发送三个数据包后，网关响应后返回的时间；

如果用`traceroute -q 4 www.58.com`, 表示向每个网关发送4个数据包。

有时我们`traceroute`一台主机时，会看到有一些行是以**星号**表示的。出现这样的情况，可能是防火墙封掉了`ICMP`的返回信息，所以我们得不到什么相关的数据包返回数据。

有时我们在某一网关处延时比较长，有可能是某台网关比较阻塞，也可能是物理设备本身的原因。当然如果某台`DNS`出现问题时，不能解析主机名、域名时，也会 有延时长的现象；您可以加`-n`参数来避免`DNS`解析，以`IP`格式输出数据。

