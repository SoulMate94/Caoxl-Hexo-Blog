---
title: Linux 命令 「top」
date: 2018-06-05 14:08:33
categories: Linux cmd
tags: [Linux]
---

# `top`

显示当前系统正在执行的进程的相关信息

<!-- more -->

# 命令参数

- `-b`: 批处理
- `-c`: 显示完整的治命令
- `-I`: 忽略失效过程
- `-s`: 保密模式
- `-S`: 累计模式
- `-i`<时间>: 设置间隔时间
- `-u`<用户名>: 指定用户名
- `-p`<进程号>: 指定进程
- `-n`<次数>: 循环显示的次数

# 说明

## 第一行 `top` 任务队列信息

- `13:57:14` - 当前系统时间
- `up 20 days, 2:08` - 系统 已经运行了20天2小时8分钟(期间未重启)
- `2 users` - 当前有2个用户登录
- `load average: 1.15 1.42 1.44` - 后面的三个数分别是1分钟, 5分钟, 15分钟的负载情况

> load average数据是每隔5秒钟检查一次活跃的进程数，然后按特定算法计算出的数值。如果这个数除以逻辑CPU的数量，结果高于5的时候就表明系统在超负荷运转了。

## 第二行 `Tasks` 任务(进程)

- 系统现在共有 `85` 个进程, 骑士处于运行中的有 `1`个,`51`个正在休眠(sleeping),stopped状态的有`0`个,zombie(僵尸)状态的有`0`个
 
## 第三行 `%Cpu(s)` 状态信息

- `5.9% us` - 用户空间占用CPU的百分比
- `0.3% sy` - 内核空间占用CPU的百分比
- `0.0% ni` - 改变过优先级的进程占用CPU的百分比
- `90.3% id` - 空闲CPU百分比
- `0.0% wa` - IO等待占用CPU的百分比
- `0.0% hi` - 硬中断(Hardware IRQ)占用CPU的百分比
- `0.2% si` - 软中断(Software Interrupts)占用CPU的百分比
- `0.0% st` - 虚拟 CPU 等待实际 CPU 的时间的百分比

> **备注：在这里CPU的使用比率和windows概念不同，需要理解linux系统用户空间和内核空间的相关知识！**

## 第四行 `Kib Mem` 内存状态

- `1009956 total` - 物理内存总量
- `520204 free`   - 空闲的内存总量
- `329436 used`   - 使用中的内存总量
- `160269 buff/cache` - 缓存的内存量


## 第五行 `Kib Swap` swap 交换分区信息

- `0 table` - 交换区总量
- `0 free`  - 空闲的交换区总量
- `0 used`  - 使用中的交换区总量
- `522924 avail Mem` -  缓冲的交换区总量

> 第四行中使用中的内存总量（used）指的是现在系统内核控制的内存数，空闲内存总量（free）是内核还未纳入其管控范围的数量。纳入内核管理的内存不见得都在使用中，还包括过去使用过的现在可以被重复利用的内存，
内核并不把这些可被重新使用的内存交还到free中去，因此在linux上free内存会越来越少，但不用为此担心。

如果出于习惯去计算可用内存数，这里有个近似的计算公式：`第四行的free` + `第四行的buffers` + `第五行的cached`

```
    520204+160269+522924 = 1203397 = 1G左右
```

> 对于内存监控，在top里我们要时刻监控第五行swap交换分区的used，
如果这个数值在不断的变化，说明内核在不断进行内存和swap的数据交换，这是真正的内存不够用了。

## 第六行 空行

## 第七行 各进程(任务)的状态监控

- `PID` - 进程id
- `USER` - 进程所有者
- `PR` - 进程优先级
- `NI` - nice值. 负值表示高优先级, 正值表示低优先级
- `VIRT` - 进程使用的虚拟内存总量, 单位(kb). `VIRT=SWAP+RES`
- `RES` - 进程使用的,未被换出的物理内存大小,单位(kb). `RES=CODE+DATA`
- `SHR` - 共享内存大小, 单位(kb).
- `S` - 进程状态.
  - `D`=不可中断的睡眠状态
  - `R`=运行
  - `S`=睡眠
  - `T`=跟踪/停止
  - `Z`=僵尸进程
- `%CPU` - 上次更新到现在的CPU时间占用百分比
- `%MEM` - 进程使用的物理内存百分比
- `TIME` - 进程使用的CPU时间总计, 单位1/100秒
- `COMMAND` - 进程名称 (命令名/命令行)